!function($){window.Posterno=window.Posterno||{},window.Posterno.cacheSelectors=function(){window.Posterno.formSelectFields=$(".pno-field-multiselect select, .pno-select-searchable, .pno-field-term-select select"),window.Posterno.dropzoneFields=$('[data-toggle="dropzone"]')},window.Posterno.bootstrapTooltips=function(){pno_settings.bootstrap&&$('[data-toggle="tooltip"]').tooltip()},window.Posterno.removeUploadedFiles=function(){$(document.body).on("click",".pno-remove-uploaded-file",function(){var dropzone=$(this).data("dropped");return $("."+dropzone).removeClass("d-none"),$(this).closest(".pno-uploaded-file").remove(),!1})},window.Posterno.select2=function(){window.Posterno.formSelectFields.length&&$(window.Posterno.formSelectFields).select2({theme:"default",placeholder:$(this).data("placeholder"),width:"100%"})},window.Posterno.dropzoneInit=function(){window.Posterno.dropzoneFields.length&&(Dropzone.autoDiscover=!1,window.Posterno.dropzoneFields.each(function(){var theDropzoneElement=$(this),dropzoneMaxFiles=$(this).data("max-files"),dropzonePostUrl=$(this).data("dropzone-url"),dropzonePreview=$(this).find(".dz-preview"),dropzoneMaxSize=$(this).data("max-size"),dropzoneMultiple=$(this).data("multiple"),dropzoneFieldID=$(this).data("field-id"),dropzoneAcceptedFiles=$(this).data("file-types"),dropzoneComponents=$(this).next(".pno-dropzone-components"),dropzoneStoredFiles=[],PosternoDropzone=new Dropzone($(this).get(0),{url:dropzonePostUrl,thumbnailWidth:null,thumbnailHeight:null,maxFiles:dropzoneMaxFiles,maxFilesize:dropzoneMaxSize,previewsContainer:dropzonePreview.get(0),previewTemplate:dropzonePreview.html(),addRemoveLinks:!1,acceptedFiles:dropzoneAcceptedFiles,params:{max_size:dropzoneMaxSize,max_files:dropzoneMaxFiles,multiple:dropzoneMultiple,field_id:dropzoneFieldID},dictDefaultMessage:pno_submission.dropzone.dictDefaultMessage,dictFallbackMessage:pno_submission.dropzone.dictFallbackMessage,dictFileTooBig:pno_submission.dropzone.dictFileTooBig,dictInvalidFileType:pno_submission.dropzone.dictInvalidFileType,dictResponseError:pno_submission.dropzone.dictResponseError,dictCancelUpload:pno_submission.dropzone.dictCancelUpload,dictUploadCanceled:pno_submission.dropzone.dictUploadCanceled,dictCancelUploadConfirmation:pno_submission.dropzone.dictCancelUploadConfirmation,dictRemoveFile:pno_submission.dropzone.dictRemoveFile,dictMaxFilesExceeded:pno_submission.dropzone.dictMaxFilesExceeded});dropzonePreview.html(""),window.Posterno.dropzoneGetFilesToMock(PosternoDropzone,dropzoneComponents),PosternoDropzone.on("dragenter",function(){theDropzoneElement.addClass("pno-dropzone-dragging")}),PosternoDropzone.on("dragleave",function(){theDropzoneElement.removeClass("pno-dropzone-dragging")}),PosternoDropzone.on("drop",function(){theDropzoneElement.removeClass("pno-dropzone-dragging")}),PosternoDropzone.on("sending",function(file){window.Posterno.dropzoneShowProgress(dropzoneComponents)}),PosternoDropzone.on("totaluploadprogress",function(progress){var progressBar=dropzoneComponents.find(".pno-dropzone-progress .progress-bar");window.Posterno.dropzoneSetProgress(progressBar,progress)}),PosternoDropzone.on("queuecomplete",function(progress){window.Posterno.dropzoneHideProgress(dropzoneComponents)}),PosternoDropzone.on("success",function(file,response){file.WordPressURL=response.data.files[0].url,file.WordPressPATH=response.data.files[0].file,dropzoneStoredFiles.push({path:response.data.files[0].file,url:response.data.files[0].url}),window.Posterno.dropzoneStoreResponse(dropzoneComponents,dropzoneStoredFiles)}),PosternoDropzone.on("error",function(file,error,xhr){PosternoDropzone.removeFile(file),window.Posterno.drozoneShowError(dropzoneComponents,file,error,xhr)}),PosternoDropzone.on("removedfile",function(file){if(window.Posterno.dropzoneHideError(dropzoneComponents),pno_submission.is_editing_mode)window.Posterno.dropzoneUnattachFilesFromListing(file.wp_id,pno_submission.editing_listing_id),PosternoDropzone.element.classList.remove("dz-max-files-reached");else{window.Posterno.dropzoneRemoveFilesFromServer(file);var removeFilePath=file.WordPressPATH,index=dropzoneStoredFiles.map(function(e){return e.path}).indexOf(removeFilePath);dropzoneStoredFiles.splice(index,1),window.Posterno.dropzoneStoreResponse(dropzoneComponents,dropzoneStoredFiles)}})}))},window.Posterno.drozoneShowError=function(component,file,error,xhr){var errorAlertContainer=component.find(".pno-dropzone-error");errorAlertContainer.removeClass("d-none"),void 0!==error.data&&void 0!==error.data.message?errorAlertContainer.find(".alert").text(error.data.message):errorAlertContainer.find(".alert").text(error)},window.Posterno.dropzoneHideError=function(component){component.find(".pno-dropzone-error").addClass("d-none")},window.Posterno.dropzoneShowProgress=function(component){var progressComponent=component.find(".pno-dropzone-progress"),progressBar=component.find(".pno-dropzone-progress .progress-bar");progressComponent.length&&(progressComponent.removeClass("d-none"),window.Posterno.dropzoneSetProgress(progressBar,"0"))},window.Posterno.dropzoneSetProgress=function(progressBar,progress){progressBar.attr("aria-valuenow",progress),progressBar.text(progress+"%"),progressBar.css("width",progress+"%")},window.Posterno.dropzoneHideProgress=function(component){var progressComponent=component.find(".pno-dropzone-progress"),progressBar=component.find(".pno-dropzone-progress .progress-bar");progressComponent.addClass("d-none"),progressComponent.length&&window.Posterno.dropzoneSetProgress(progressBar,"0")},window.Posterno.dropzoneStoreResponse=function(component,response){component.find("input[type=hidden]").val(JSON.stringify(response))},window.Posterno.dropzoneResetStoredResponse=function(component){var hiddenInput=component.find("input[type=hidden]");hiddenInput.length&&hiddenInput.val("")},window.Posterno.dropzoneGetStoredResponse=function(component){return component.find("input[type=hidden]").val()},window.Posterno.dropzoneRemoveFilesFromServer=function(file){file.WordPressPATH&&file.WordPressURL&&$.post({url:pno_submission.ajax,data:{action:"pno_remove_dropzone_file",file_path:file.WordPressPATH,file_url:file.WordPressURL,nonce:pno_submission.dropzone_remove_file_nonce}})},window.Posterno.dropzoneGetFilesToMock=function(myDropzone,component){var hiddenInput=component.find("input[type=hidden]");if(0<hiddenInput.length){if(!hiddenInput.val())return;var storedImages=JSON.parse(hiddenInput.val());if(1<myDropzone.options.maxFiles)for(var i=0;i<storedImages.length;i++){var mockFile={name:storedImages[i].image_name,size:storedImages[i].image_size,wp_id:storedImages[i].image_id};myDropzone.emit("addedfile",mockFile),myDropzone.emit("thumbnail",mockFile,storedImages[i].image_url),myDropzone.emit("complete",mockFile),myDropzone.files.push(mockFile);var existingFileCount=storedImages.length;myDropzone.options.maxFiles=myDropzone.options.maxFiles-existingFileCount}else{if(!storedImages.image_url)return;mockFile={name:storedImages.image_name,size:storedImages.image_size,wp_id:storedImages.image_id};myDropzone.emit("addedfile",mockFile),myDropzone.emit("thumbnail",mockFile,storedImages.image_url),myDropzone.emit("complete",mockFile),myDropzone.files.push(mockFile);existingFileCount=1;myDropzone.options.maxFiles=myDropzone.options.maxFiles-existingFileCount,myDropzone.element.classList.add("dz-max-files-reached")}}},window.Posterno.dropzoneUnattachFilesFromListing=function(attachment_id,listing_id){attachment_id&&$.post({url:pno_submission.ajax,data:{action:"pno_unattach_files_from_listing",attachment_id:attachment_id,listing_id:listing_id,nonce:pno_submission.dropzone_unattach_files_nonce}})},$(document).ready(function(){window.Posterno.cacheSelectors(),window.Posterno.bootstrapTooltips(),window.Posterno.removeUploadedFiles(),window.Posterno.select2(),window.Posterno.dropzoneInit()})}(jQuery);